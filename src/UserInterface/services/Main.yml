imports:
    - { resource: Analysis.yml }
    - { resource: Indexing.yml }
    - { resource: Tooltips.yml }
    - { resource: Linting.yml }
    - { resource: PrettyPrinting.yml }
    - { resource: UserInterface/Command.yml }

parameters:


services:
    lexer:
        class: PhpParser\Lexer
        arguments:
            - usedAttributes:
                - comments
                - startLine
                - endLine
                - startFilePos
                - endFilePos

    parser.phpParserFactory:
        class: PhpParser\ParserFactory

    parser.phpParser:
        class: PhpParser\Parser
        factory:
            - '@parser.phpParserFactory'
            - 'create'
        arguments:
            - !php/const:PhpParser\ParserFactory::PREFER_PHP7
            - '@lexer'

    parser.cachingParserProxy:
        class: PhpIntegrator\Parsing\CachingParserProxy
        arguments:
            - '@parser.phpParser'

    parser:
        alias: parser.cachingParserProxy

    cache:
        class: Doctrine\Common\Cache\ArrayCache

    partialParser:
        class: PhpIntegrator\Parsing\PartialParser
        arguments:
            - '@parser.phpParserFactory'
            - '@lexer'

    parserTokenHelper:
        class: PhpIntegrator\Parsing\ParserTokenHelper

    lastExpressionParser:
        class: PhpIntegrator\Parsing\LastExpressionParser
        arguments:
            - '@partialParser'
            - '@parserTokenHelper'

    signatureHelpRetriever:
        class: PhpIntegrator\SignatureHelp\SignatureHelpRetriever
        arguments:
            - '@parser'
            - '@parserTokenHelper'
            - '@functionFunctionInfoRetriever'
            - '@methodCallMethodInfoRetriever'
            - '@functionParameterPrettyPrinter'

    docblockParser:
        class: PhpIntegrator\Parsing\DocblockParser

    indexDatabase:
        class: PhpIntegrator\Indexing\IndexDatabase

    classlikeInfoBuilderProvider.backend:
        alias: indexDatabase

    classlikeInfoBuilderProvider.cachingProxy:
        class: PhpIntegrator\UserInterface\ClasslikeInfoBuilderProviderCachingProxy
        arguments:
            - '@classlikeInfoBuilderProvider.instance'
            - '@cache'

    classlikeInfoBuilderProvider:
        alias: classlikeInfoBuilderProvider.cachingProxy

    cacheClearingEventMediator:
        class: PhpIntegrator\Mediating\CacheClearingEventMediator
        arguments:
            - '@cacheClearingEventMediator.clearableCache'
            - '@indexer'
            - !php/const:PhpIntegrator\Indexing\Indexer::INDEXING_SUCCEEDED_EVENT
